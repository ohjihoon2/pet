<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Insert title here</title>
	<link rel="stylesheet" type="text/css"href="http://localhost:9090/pet/css/index.css">
	<link rel="stylesheet" type="text/css"href="http://localhost:9090/pet/css/index_carousel.css">
	<link rel="stylesheet" href="http://localhost:9090/pet/css/navbar_techandall.css"><!-- Navigation CSS -->
	<link rel="stylesheet" href="http://localhost:9090/pet/css/community.css"><!-- community CSS -->
	<link href="http://localhost:9090/pet/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	
	<script src="http://localhost:9090/pet/js/jquery-3.4.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js">
	<script type="text/javascript" src="http://localhost:9090/pet/js/ddmenu.js"></script>
	<script src="http://localhost:9090/pet/js/header_toggle.js"></script>  <!-- header_toggle js -->
		
	<script>
	$(document).ready(function(){
		
		var wno = "";
		/**
		*	ajax delete 함수
		*/
		function wonderReplyDeleteAjax(qrdb, wonder_reply_no, wno){
			alert("3.wno = "+wno);
			if(qrdb == 'wrdbtn'){
  				var confirmdel = confirm("삭제하시겠습니까?");
  				
  				if(confirmdel == true){
  	  				
	  	  			$.ajax({
	  	  				url:"wonder_reply_delete_proc.do?wonder_reply_no="+wonder_reply_no+"&wonder_no="+wno,
	  	  				success:function(result){
		  	  				var jsonObj = JSON.parse(result);
		  	  				wonderReplyList(jsonObj, wno); 
		  	  				//document.location.reload();
	  	  				}
	  	  			});
  				}else if(confirmdel == false){
  					alert("삭제를 취소하셨습니다.");
  				}
  			}
		}
		
		/**
		*	wonder_reply_list ajax 함수
		*/
		function wonderReplyAjax(wno){
			alert("1.wno = "+wno);
			$.ajax({
				url:"wonder_reply_list.do?wonder_no="+wno,
				success:function(result){
					var jsonObj = JSON.parse(result);
					wonderReplyList(jsonObj, wno); 
				}
			});
		}
		
		/**
		*	wonderReplyList append 이벤트
		*/
		function wonderReplyList(jsonObj, wno){
			alert("2.wno = "+wno);
			var str = "";
			for(i=0;i<jsonObj.wrlist.length;i++){
				str += "<p class='question_comment_id'>"
						+"<strong>"+jsonObj.wrlist[i].wonder_reply_writer+"</strong>"
						+"</p>"
						+"<button type='button' id='wrdbtn"+jsonObj.wrlist[i].wonder_reply_no+"' class='wrdbtn' style='float : right; border : 1px solid red; padding:2px; display:inline-block;'>삭제</button>"
						+"<div class='question_comment_text'>"
						+	jsonObj.wrlist[i].wonder_reply_content
						+"</div>"
						+"<p class='question_comment_date'>"+jsonObj.wrlist[i].wonder_reply_date+"</p>"
			}
			$('.question_comment_view').empty();
			$('.question_comment_view').append(str);
  			$("div.question_comment_space").show();
  			
  			/**
  			*	질문 댓글 삭제 클릭 이벤트
  			*/
  			$("div.question_comment_view > button").click(function(){
  				var qrdb = $(this).attr("class");
  				var id = $(this).attr("id");
  				var wonder_reply_no = id.substring(6);
  				if(qrdb == 'wrdbtn'){
	 				wonderReplyDeleteAjax(qrdb, wonder_reply_no, wno);
  				}
 				
 				
  			});
  			
		}
		
		/**
		*	질문 댓글 button 이벤트
		*/
		$("div.question_comment_space").hide();
		
  		$(".questionBtn").click(function(){
  			wno = $(this).attr("id");
  			var test = $("#test").val();
  			if(test == "hidden"){
  				$("div.question_comment_space").show();
  				wonderReplyAjax(wno);
  				
	  			$("#test").val("show");
  			}else{
  				$("div.question_comment_space").hide();
	  			$("#test").val("hidden");
  			}
  		});
		
  		/* $(".questionBtn").toggle(
   			function(){
   				var wno = $(this).attr("id");
   				$.ajax({
   					url:"wonder_reply_list.do?wonder_no="+wno,
   					success:function(result){
   						var jsonObj = JSON.parse(result);
   						wonderReplyList(jsonObj); 
			  			
   						//댓글 
			  			$("div.question_comment_view > button").click(function(){
			  	  			var qrdb = $(this).attr("class");
			  	  			if(qrdb == 'wrdbtn'){
			  	  				var confirmdel = confirm("삭제하시겠습니까?");
			  	  				if(confirmdel == true){
				  	  				var did = $(this).attr("id");
				  	  				var wonder_reply_no = did.substring(6);
					  	  			$.ajax({
					  	  				url:"wonder_reply_delete_proc.do?wonder_reply_no="+wonder_reply_no+"&wonder_no="+wno,
					  	  				success:function(result){
						  	  				var jsonObj = JSON.parse(result);
						  	  				wonderReplyList(jsonObj); 
						  	  				document.location.reload();
					  	  				},
					  	  				complete: function(){
					  	  					$("#test").val("a");
					  	  				}
					  	  			});
			  	  				}else if(confirmdel == false){
			  	  					alert("삭제를 취소하셨습니다.");
			  	  				}
			  	  				
			  	  				
			  	  			}else{
			  	  				alert('수정버튼');
				  	  			var uid = $(this).attr("id");
			  	  				alert("uid = "+uid);
			  	  			}
			  	  		})
   					}
   				});
   			},
   			function(){
   				$(".question_comment_view").empty();
	  			$("div.question_comment_space").hide();
   			}
   		); */
  		
  		/**
		*	질문 댓글 입력버튼
		*/
		$(".wonder_reply_registerCommentBtn").click(function(){
			var rid = $(this).attr("id");
			
			var text = $("textarea#"+rid).val();
			
			/* var wonder_no = $("input#"+rid).val(); */
			var wonder_no = $(".question_content_third > button").attr("id");
					
			var rno = rid.substring(8);
			if(text ==""){
				alert("댓글을 작성하세요.");
				$("#question_comment_write_area").focus();
			}else{
				if(text.length > 1000){
				alert("1000글자 이내로 작성해 주세요");
				$("#question_comment_write_area").focus();
				}else{
					$.ajax({
						url:"wonder_reply_proc.do?wonder_reply_writer='test'"+"&wonder_reply_content="+text+"&wonder_no="+wonder_no,
						success:function(result){
							var jsonObj = JSON.parse(result);
							var str = "";
							for(i=0;i<jsonObj.wrlist2.length;i++){
								str += "<p class='wonder_comment_id'>"
										+"<strong>"+jsonObj.wrlist2[i].wonder_reply_writer+"</strong>"
										+"</p>"
										+"<button type='button' id='wrdbtn"+jsonObj.wrlist2[i].wonder_reply_no+"' class='wrdbtn"+jsonObj.wrlist2[i].wonder_reply_no+"' style='float : right; border : 1px solid red; padding:2px; display:inline-block;'>삭제</button>"
										+"<div class='wonder_comment_text'>"
										+jsonObj.wrlist2[i].wonder_reply_content
										+"</div>"
								+"<p class='wonder_comment_date'>"+jsonObj.wrlist2[i].wonder_reply_date+"</p>"
							}
						
	/* 						$('.answer_comment_view').append(str); */
							$(".question_comment_write_area").val('');
							$('#wonder'+rno).empty();
							$('#wonder'+rno).append(str);
						}
					});
				}
			}
		});
  		
  		
  		/**
  		*	답변하기 toggle 
  		*/
  		$(".my_answer_write").hide();
  		$(".answerWriteBoardBtn").toggle(
			function(){
				$(".my_answer_write").css("margin-top","30px");
  				var str = "<iframe width='850px' height='660px' src='answerNew.do?wonder_no=${wvo.wonder_no}' class='my_editor'></iframe>";
				$("div.my_answer_body div.my_answer_write").append(str);
				$(".my_answer_write").show();
   			},
    		function(){
				$("div.my_answer_body div.my_answer_write").empty();
	   		}
   		);
  		
  		/**
		*	답변  댓글 button 이벤트
		*/
		
		
		$("div.answer_comment_space").hide();
		var rid = '';
		
  		$(".answerBtn").click(function(){
  			alert("1");
  			rid = $(this).attr("name");//wonder_answer_no
  			rno = $(this).attr("id");//"reply"+wonder_answer_no
  			alert("rid =" + rid);
  			var answerFlag = $(".answerFlag"+rid).val();
  			if(answerFlag == "hidden"){
  				alert("show 이지요");
  				
  				$("div#"+rno).show();
  				answerReplyAjax(rid,rno);
  				
	  			$(".answerFlag"+rid).val("show");
  			}else{
  				alert("hidden 이지요");
  				$("div#"+rno).hide();
	  			$(".answerFlag"+rid).val("hidden");
  			}
  		});
  		
		
  		function answerReplyAjax(rid,rno){
  			alert("3.rid = "+rid);
  			$.ajax({
				url:"answer_reply_list.do?wonder_answer_no="+rid,
				success:function(result){
					var jsonObj = JSON.parse(result);
					answerReplyList(jsonObj, rid,rno);
		  			
  				}
			});	
  		}
  		
  		function answerReplyList(jsonObj, rid,rno){
  			alert("4.rid= "+rid	);
  			var str = "";
			for(i=0;i<jsonObj.arlist.length;i++){
				
				str += "<p class='answer_comment_id'>"
						+"<strong>"+jsonObj.arlist[i].wonder_answer_reply_writer+"</strong>"
						+"</p>"
						+"<button type='button' id='ardbtn"+jsonObj.arlist[i].wonder_answer_reply_no+"' class='ardbtn"+jsonObj.arlist[i].wonder_answer_reply_no+"' style='float : right; border : 1px solid red; padding:2px; display:inline-block;'>삭제</button>"
						+"<div class='answer_comment_text'>"
						+jsonObj.arlist[i].wonder_answer_reply_content
						+"</div>"
				+"<p class='answer_comment_date'>"+jsonObj.arlist[i].wonder_answer_reply_date+"</p>"
			}
		
  			$('#answer'+rid).empty();
			$('#answer'+rid).append(str);
  			/* $('[name='+rid+']').show(); */
  			
/* 			$('.question_comment_view').append(str);*/
  			$("div.#"+rno).show();
			
  			$("div.answer_comment_view > button").click(function(){
  	  			var ardb = $(this).attr("class");
  	  			alert(ardb);
  	  		})
  		}
  		
  		 /**
  		 * 답변 댓글 toggle 기능
  		 */
		/* $("div.answer_comment_space").hide();
  		$(".answerBtn").toggle(
  				function(){
	  			var rid=$(this).attr("id");
	  			var rno =$(this).attr("name");
	  			var rno = rid.substring(5);
	  			$.ajax({
					url:"answer_reply_list.do?wonder_answer_no="+rno,
					success:function(result){
						var jsonObj = JSON.parse(result);
						var str = "";
						for(i=0;i<jsonObj.arlist.length;i++){
							
							str += "<p class='answer_comment_id'>"
									+"<strong>"+jsonObj.arlist[i].wonder_answer_reply_writer+"</strong>"
									+"</p>"
									+"<button type='button' id='ardbtn"+jsonObj.arlist[i].wonder_answer_reply_no+"' class='ardbtn"+jsonObj.arlist[i].wonder_answer_reply_no+"' style='float : right; border : 1px solid red; padding:2px; display:inline-block;'>삭제</button>"
									+"<div class='answer_comment_text'>"
									+jsonObj.arlist[i].wonder_answer_reply_content
									+"</div>"
							+"<p class='answer_comment_date'>"+jsonObj.arlist[i].wonder_answer_reply_date+"</p>"
						}
					
						$('#answer'+rno).append(str);
			  			$("div#"+rid).show();
						
			  			$("div.answer_comment_view > button").click(function(){
			  	  			var ardb = $(this).attr("class");
			  	  			alert(ardb);
			  	  		})
			  			
	  				}
				});
  				},
  	    		function(){
		  			var rid=$(this).attr("id");
		  			var rno =$(this).attr("name");
		  			$('#answer'+rno).empty();
		  			$("div#"+rid).hide();
  		   		}
  		); */
  		
  		
  		/**
  			답변 댓글 입력버튼
  		*/
  		$(".answer_reply_registerCommentBtn").click(function(){
  			var rid = $(this).attr("id");
  			var text = $("textarea#"+rid).val();
  			var answer_no = $("input#"+rid).val();
  			var rno = rid.substring(8);
  			if(text ==""){
  				alert("댓글을 작성하세요.");
  				$("#answer_comment_write_area").focus();
  			}else{
  				if(text.length > 1000){
					alert("1000글자 이내로 작성해 주세요");
					$("#answer_comment_write_area").focus();
				}else{
					$.ajax({
						url:"answer_reply_proc.do?wonder_answer_reply_writer='test'"+"&wonder_answer_reply_content="+text+"&wonder_answer_no="+answer_no,
						success:function(result){
							var jsonObj = JSON.parse(result);
							var str = "";
							for(i=0;i<jsonObj.arlist2.length;i++){
								str += "<p class='answer_comment_id'>"
										+"<strong>"+jsonObj.arlist2[i].wonder_answer_reply_writer+"</strong>"
										+"</p>"
										+"<button type='button' id='replydeletebtn"+jsonObj.arlist2[i].wonder_answer_reply_no+"' class='replydelete"+jsonObj.arlist2[i].wonder_answer_reply_no+"' style='float : right; border : 1px solid red; padding:2px; display:inline-block;'>삭제</button>"
										+"<div class='answer_comment_text'>"
										+jsonObj.arlist2[i].wonder_answer_reply_content
										+"</div>"
								+"<p class='answer_comment_date'>"+jsonObj.arlist2[i].wonder_answer_reply_date+"</p>"
								+"<input type='hidden' id='"+jsonObj.arlist2[i].wonder_answer_reply_no+"' value='"+jsonObj.arlist2[i].wonder_answer_reply_no+"'>"
								
							}
							
	/* 						$('.answer_comment_view').append(str); */
							$(".answer_comment_write_area").val('');
							$('#answer'+rno).empty();
							$('#answer'+rno).append(str);
							
							
						}
						
						
					});
					
				}
  			}
  		});
  		
	});//end of document
	
	</script>
</head>
<body>
	<div>
		<input type="hidden" id="test" value="hidden">
		<div class="wonderDetailContentBox">
			<div class=wonderDetail_hole>
				<div class="question_back">
					<div class="question_content">
						<div class="question_content_first">
							<div class="question_icon">
								<i class="">Q</i>
							</div>
							<div class=question_title_content>
								${wvo.wonder_title }
							</div>
						</div><!-- ggg -->
						<div class="question_content_second">
							${wvo.wonder_content }
						</div>
						<div class="question_content_third">
							<span>${wvo.wonder_writer}</span>/<span>${wvo.wonder_date }</span>/<span>조회수 ${wvo.wonder_view }</span> 
							<button type="button" class="questionBtn" id="${wvo.wonder_no }">댓글버튼</button>
						</div>
						<div class="question_comment_space">
							<fieldset>
								<legend>댓글 입력</legend>	
								<div class="question_comment_write">
									<textarea class="question_comment_write_area" id="qrRegist${wvo.wonder_no }" maxlength="1000" title="댓글 입력" placeholder= "개인정보를 공유 및 요청하거나, 명예 훼손, 무단 광고, 불법 정보 유포시 모니터링 후 삭제될 수 있으며, 이에 대한 민형사상 책임은 게시자에게 있습니다."></textarea>
									<button type="submit" class="wonder_reply_registerCommentBtn" id="qrRegist${wvo.wonder_no }">등록</button>
								</div>
								<div class="question_comment_info">
									<div class="c-opinion__write-count">
										<span class="question_comment_write_count_current">0</span>
										/
										<span class="question_comment_write_count_total">1000</span>
									</div>
								</div>
							</fieldset>
							<div class="question_comment_view" id="wonder${wvo.wonder_no }">
								
							</div>
						</div>
					</div>
				</div><!-- question_back end -->
					
				<div class="answer_back">
					<div id="answerWriteArea" class="answer_content_write">
						<div class="my_answer_editor" id="answerWriteButtonArea">
							<div class="my_answer_body">
								<div class="my_answer_title">
										<p class="title">t1es23yt님, 답변해주세요!</p>
								</div>
								<div class="my_answer_button">
									<a href="#" id="answerWriteButton" role="button" aria-expanded="false" aria-controls="" class="c-button-default c-button-default--blue"><span class="answerWriteBoardBtn">답변하기</span></a>
								</div>
								<div class="my_answer_write">
									
								</div>
							</div>
						</div>
						<div id="smartEditorArea" class="qna_answer_editor" style="display:none"></div>
					</div>
					<c:forEach var="avo" items="${alist}">
						<div class="answer_content" >
							<div class="answer_content_first">
								<div class="answer_icon">
									<i class="">A</i>
								</div>
								<div class=answer_title_content>
									${avo.wonder_answer_writer } 님의 답변.
								</div>
							</div>
							<div class="answer_content_second">
								<span class="answer_title_side">${avo.wonder_answer_title}</span>
								${avo.wonder_answer_content}
							</div>
							<div class="answer_content_third">
								<span>${avo.wonder_answer_date }</span>
								<button type="button" class="answerBtn" id="reply${avo.wonder_answer_no }" name="${avo.wonder_answer_no }">댓글버튼</button>
							</div>
							<div class="answer_comment_space" id="reply${avo.wonder_answer_no }">
								<fieldset>
									<legend>댓글 입력</legend>
									<div class="answer_comment_write" id="${avo.wonder_answer_no}">
										<textarea class="answer_comment_write_area" id="arRegist${avo.wonder_answer_no }" maxlength="1000" title="댓글 입력" placeholder= "개인정보를 공유 및 요청하거나, 명예 훼손, 무단 광고, 불법 정보 유포시 모니터링 후 삭제될 수 있으며, 이에 대한 민형사상 책임은 게시자에게 있습니다."></textarea>
										<button type="submit" class="answer_reply_registerCommentBtn" id="arRegist${avo.wonder_answer_no }">등록</button>
									</div>
									<div class="answer_comment_info">
										<div class="c-opinion__write-count">
											<span class="answer_comment_write_count_current">0</span>
											/
											<span class="answer_comment_write_count_total">1000</span>
										</div>
									</div>
								</fieldset>
								<div class="answer_comment_view" id="answer${avo.wonder_answer_no }">
									
								</div>
							</div>
							<input type="hidden" id="arRegist${avo.wonder_answer_no }" class="wonder_answer_no"name="wonder_answer_no" value="${avo.wonder_answer_no }">
							<input type="hidden" id="answerFlag" class="answerFlag${avo.wonder_answer_no }" value="hidden">
						</div>
					</c:forEach>
				</div><!-- answer_back end -->
			</div>
		</div>
	</div>
</body>
</html>